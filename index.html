<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Jaydmj23 - Summoner Stats - League of Legends</title>
    <style>
        :root {
            --bg-body: #1c1c1f;
            --bg-card: #31313c;
            --border-color: #2c2c32;
            --win-blue: #5383e8;
            --lose-red: #e84057;
            --text-primary: #fff;
            --text-secondary: #9e9eb1;
            --win-bg: #28344e;
            --lose-bg: #59343b;
        }

        body {
            font-family: Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            font-size: 12px;
        }

        .container { max-width: 1000px; margin: 0 auto; }

        /* --- HEADER --- */
        .header { display: flex; gap: 20px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 20px; }
        .profile-icon-img { width: 100px; height: 100px; border-radius: 20px; border: 4px solid var(--bg-card); }
        .header-info h1 { font-size: 24px; margin: 0; font-weight: bold; }
        .header-info .tag { color: var(--text-secondary); font-weight: normal; }
        .update-btn { margin-top: 10px; background: var(--win-blue); border: none; color: white; padding: 10px 20px; border-radius: 4px; font-weight: bold; cursor: pointer; }

        /* --- GRID LAYOUT --- */
        .content { display: grid; grid-template-columns: 300px 1fr; gap: 10px; }

        /* SIDEBAR (Ranks) */
        .rank-card { background: var(--bg-card); border-radius: 4px; padding: 15px; display: flex; align-items: center; gap: 12px; margin-bottom: 8px; border: 1px solid var(--border-color); }
        .tier-img { width: 72px; background: #1c1c1f; border-radius: 50%; padding: 4px; }
        .rank-type { color: var(--text-secondary); font-size: 11px; margin-bottom: 4px; }
        .tier-text { font-size: 15px; font-weight: bold; color: var(--win-blue); }
        .lp-text { font-weight: bold; font-size: 13px; margin-top: 2px; }

        /* MAIN CONTENT */
        /* Stats Box (Donut Chart) */
        .stats-box { background: var(--bg-card); border-radius: 4px; border: 1px solid var(--border-color); padding: 12px 24px; margin-bottom: 10px; display: flex; align-items: center; justify-content: flex-start; gap: 30px; }
        
        .donut-chart {
            width: 90px; height: 90px; border-radius: 50%;
            background: conic-gradient(var(--win-blue) 0% 50%, var(--lose-red) 50% 100%);
            display: flex; align-items: center; justify-content: center;
            position: relative;
        }
        .donut-inner { width: 64px; height: 64px; background: var(--bg-card); border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2; }
        
        .kda-big { font-size: 20px; font-weight: bold; }
        .kda-ratio-big { color: var(--text-secondary); font-size: 11px; }
        .p-kill-big { color: var(--lose-red); font-size: 12px; margin-top: 4px; }

        /* GAME CARD (Collapsed) */
        .game-card { margin-bottom: 8px; border-radius: 4px; overflow: hidden; background: var(--bg-card); border: 1px solid var(--border-color); }
        .game-summary { display: flex; height: 96px; border-left: 6px solid; align-items: center; position: relative; }
        
        .game-card.win .game-summary { background-color: var(--win-bg); border-left-color: var(--win-blue); }
        .game-card.lose .game-summary { background-color: var(--lose-bg); border-left-color: var(--lose-red); }

        .info-col { width: 100px; text-align: center; color: var(--text-secondary); font-size: 11px; line-height: 16px; }
        .result { font-weight: bold; font-size: 13px; margin-bottom: 4px; }
        .win .result { color: var(--win-blue); }
        .lose .result { color: var(--lose-red); }
        
        .champ-col { width: 100px; display: flex; gap: 6px; align-items: center; }
        .champ-icon { width: 48px; height: 48px; border-radius: 50%; }
        .spells { display: flex; flex-direction: column; gap: 2px; }
        .spell-img, .rune-img { width: 22px; height: 22px; border-radius: 4px; background: #000; }
        .rune-img { border-radius: 50%; }

        .kda-col { width: 120px; text-align: center; }
        .kda-text { font-size: 15px; font-weight: bold; color: #fff; display: block; margin-bottom: 4px; }
        .deaths { color: var(--lose-red); }
        .ratio-text { font-size: 11px; font-weight: bold; color: #fff; opacity: 0.7; }

        .stats-col { width: 110px; font-size: 11px; color: var(--text-secondary); line-height: 18px; border-left: 1px solid rgba(255,255,255,0.05); padding-left: 12px; }
        .p-kill { color: var(--lose-red); }
        .tier-badge { font-weight: bold; color: #fff; }

        .items-col { margin-left: auto; display: flex; gap: 2px; margin-right: 30px; }
        .item-box { width: 22px; height: 22px; border-radius: 3px; background: rgba(0,0,0,0.3); }
        .item-box img { width: 100%; height: 100%; border-radius: 3px; }

        .btn-expand { width: 30px; height: 100%; background: rgba(0,0,0,0.1); border: none; color: #fff; cursor: pointer; position: absolute; right: 0; bottom: 0; }
        .btn-expand:hover { background: rgba(0,0,0,0.2); }

        /* EXPANDED DETAILS (Tableau Complet) */
        .game-details { display: none; background: #23232d; padding: 0; }
        .team-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        
        .team-header { padding: 8px 10px; font-size: 11px; font-weight: bold; display: flex; justify-content: space-between; border-bottom: 1px solid var(--border-color); background: rgba(0,0,0,0.2); }
        .team-blue .team-header { color: var(--win-blue); }
        .team-red .team-header { color: var(--lose-red); }

        .player-row { height: 36px; display: flex; align-items: center; padding: 0 10px; border-bottom: 1px solid #282830; }
        .player-row:hover { background: #2c2c34; }
        .player-row.is-me { background: rgba(83, 131, 232, 0.1); }

        .c-champ { width: 32px; margin-right: 6px; }
        .c-champ img { width: 32px; height: 32px; border-radius: 50%; vertical-align: middle; }
        
        .c-spells { display: flex; flex-direction: column; gap: 1px; width: 18px; margin-right: 8px; }
        .c-spells img { width: 16px; height: 16px; border-radius: 2px; }

        .c-runes { display: flex; flex-direction: column; gap: 1px; width: 18px; margin-right: 8px; }
        .c-runes img { width: 16px; height: 16px; border-radius: 50%; background: #000; }

        .c-name { width: 100px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; margin-right: 10px; }
        .name-link { color: #fff; text-decoration: none; font-size: 11px; }
        .rank-tiny { color: #666; font-size: 10px; display: block; }

        .c-opscore { width: 40px; text-align: center; margin-right: 10px;}
        .badge { padding: 2px 4px; border-radius: 4px; font-size: 9px; font-weight: bold; color: #fff; display: inline-block; }
        .badge-mvp { background: #e19205; border: 1px solid #b37504; }
        .badge-ace { background: #6c3cd4; border: 1px solid #542f9e; }
        .badge-rank { background: #3b3b44; color: #fff; border: 1px solid #333; }

        .c-kda { width: 80px; text-align: center; }
        .kda-detail { font-size: 11px; color: #888; }
        
        .c-damage { width: 80px; margin: 0 10px; text-align: center; }
        .dmg-num { font-size: 10px; color: #888; margin-bottom: 2px; }
        .dmg-bar { width: 100%; height: 6px; background: #2f2f35; overflow: hidden; }
        .dmg-fill { height: 100%; background: var(--lose-red); }

        .c-wards { width: 40px; text-align: center; color: #888; }
        .c-cs { width: 50px; text-align: center; color: #888; }
        
        .c-items { display: flex; gap: 1px; margin-left: auto; }
        .mini-item { width: 22px; height: 22px; background: #1c1c1f; border-radius: 3px; }
        .mini-item img { width: 100%; height: 100%; border-radius: 3px; }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img id="p-icon" class="profile-icon-img" src="" alt="icon">
        <div class="header-info">
            <h1 id="p-name">Chargement...</h1>
            <div id="p-ladder" class="tag">Ladder Rank: 606,449 (15.72% of top)</div>
            <button class="update-btn">Update</button>
        </div>
    </div>

    <div class="content">
        <div class="sidebar">
            <div id="ranks-container"></div>
        </div>

        <div class="main">
            <div class="stats-box">
                <div class="donut-chart" id="winrate-chart">
                    <div class="donut-inner">
                        <div style="font-weight:bold; font-size:14px;" id="winrate-text">0%</div>
                    </div>
                </div>
                <div>
                    <div class="kda-big" id="kda-display">0.0 / 0.0 / 0.0</div>
                    <div class="kda-ratio-big" id="kda-ratio-display">0.00:1 KDA</div>
                    <div class="p-kill-big" id="pkill-display">P/Kill 0%</div>
                </div>
            </div>

            <div id="games-container"></div>
        </div>
    </div>
</div>

<script>
    const D_DRAGON_IMG = "https://ddragon.leagueoflegends.com/cdn/14.23.1/img";
    const CDN = "https://raw.communitydragon.org/latest/plugins/rcp-be-lol-game-data/global/default/v1";

    // Mapping partiel des sorts pour l'exemple (à compléter pour la perfection)
    const spellMap = {
        1: "SummonerBoost", 3: "SummonerExhaust", 4: "SummonerFlash", 6: "SummonerHaste",
        7: "SummonerHeal", 11: "SummonerSmite", 12: "SummonerTeleport", 14: "SummonerDot",
        21: "SummonerBarrier", 32: "SummonerSnowball"
    };

    fetch('opgg_clone_data.json')
        .then(res => res.json())
        .then(data => {
            const profile = data.profile;
            const stats = data.stats_summary;

            // 1. Remplir Header
            document.getElementById('p-name').innerHTML = `${profile.name} <span class="tag">#${profile.tag}</span>`;
            document.getElementById('p-icon').src = profile.icon_url;

            // 2. Sidebar Ranks
            const rankDiv = document.getElementById('ranks-container');
            // Si pas de rangs détectés, on met un placeholder
            if(profile.ranks.length === 0) {
                profile.ranks.push({ queue: "Solo/Duo", tier: "Unranked", lp: "0 LP", winrate: "" });
            }
            
            profile.ranks.forEach(rank => {
                // Détection auto de l'image du rang (basique)
                let tierName = rank.tier.split(' ')[0].toLowerCase();
                if(tierName === "unranked") tierName = "provisional"; // Image par défaut
                
                rankDiv.innerHTML += `
                    <div class="rank-card">
                        <img src="https://opgg-static.akamaized.net/images/medals_new/${tierName}.png" class="tier-img" onerror="this.src='https://opgg-static.akamaized.net/images/medals_new/provisional.png'">
                        <div>
                            <div class="rank-type">${rank.queue}</div>
                            <div class="tier-text">${rank.tier}</div>
                            <div class="lp-text">${rank.lp}</div>
                        </div>
                    </div>
                `;
            });

            // 3. Stats Box (Donut)
            if(stats.total_games > 0) {
                const wr = Math.round((stats.wins / stats.total_games) * 100);
                const avgK = (stats.kills / stats.total_games).toFixed(1);
                const avgD = (stats.deaths / stats.total_games).toFixed(1);
                const avgA = (stats.assists / stats.total_games).toFixed(1);
                const kdaRatio = ((stats.kills + stats.assists) / Math.max(1, stats.deaths)).toFixed(2);

                document.getElementById('winrate-text').innerText = `${wr}%`;
                document.getElementById('kda-display').innerText = `${avgK} / ${avgD} / ${avgA}`;
                document.getElementById('kda-ratio-display').innerText = `${kdaRatio}:1 KDA`;
                
                // Le dégradé du donut : Bleu jusqu'au % de victoire, Rouge après
                document.getElementById('winrate-chart').style.background = `conic-gradient(#5383e8 0% ${wr}%, #e84057 ${wr}% 100%)`;
            }

            // 4. Liste des Matchs
            const container = document.getElementById('games-container');
            
            data.history.forEach((game, index) => {
                const me = game.my_stats;
                const isWin = game.result === "WIN";
                const resultClass = isWin ? "win" : "lose";
                const resultText = isWin ? "Victory" : "Defeat";

                // --- Génération de la ligne du joueur étendu ---
                const renderPlayer = (p) => {
                    const isMe = p.is_me ? "is-me" : "";
                    const dmgPercent = Math.round((p.damage / game.max_damage) * 100);
                    
                    // Badges
                    let badgeHtml = "";
                    if (p.op_rank === 1) badgeHtml = `<span class="badge badge-mvp">MVP</span>`;
                    else if (p.op_rank === 2) badgeHtml = `<span class="badge badge-ace">ACE</span>`;
                    else badgeHtml = `<span class="badge badge-rank">${p.op_rank}th</span>`;

                    // Items
                    const itemsHtml = p.items.map(id => 
                        id ? `<div class="mini-item"><img src="${D_DRAGON_IMG}/item/${id}.png"></div>` : `<div class="mini-item"></div>`
                    ).join('');

                    // Sorts et Runes
                    const spell1 = spellMap[p.spells[0]] || "SummonerFlash";
                    const spell2 = spellMap[p.spells[1]] || "SummonerFlash";
                    // Hack pour les runes : url un peu compliquée, on met un placeholder propre si besoin
                    // Utilisation de perk-images/styles/ pour la rune principale
                    const runeUrl = `https://raw.communitydragon.org/latest/plugins/rcp-be-lol-game-data/global/default/v1/perk-images/styles/${p.rune_style}/${p.runes}.png`; 

                    return `
                    <div class="player-row ${isMe}">
                        <div class="c-champ"><img src="${CDN}/champion-icons/${p.champion_id}.png"></div>
                        <div class="c-spells">
                            <img src="${D_DRAGON_IMG}/spell/${spell1}.png">
                            <img src="${D_DRAGON_IMG}/spell/${spell2}.png">
                        </div>
                        <div class="c-runes">
                            <img src="${CDN}/perk-images/styles/7200/8000.png" style="opacity:0;"> </div>
                        <div class="c-name">
                            <a href="#" class="name-link">${p.name}</a>
                            <span class="rank-tiny">${p.tier}</span>
                        </div>
                        <div class="c-opscore">
                            <div style="font-weight:bold; font-size:11px; margin-bottom:2px;">${p.op_score}</div>
                            ${badgeHtml}
                        </div>
                        <div class="c-kda">
                            <div style="font-size:11px; color:#aaa;">${p.k}/${p.d}/${p.a}</div>
                            <div style="font-weight:bold; font-size:11px;">${p.kda_ratio}:1</div>
                        </div>
                        <div class="c-damage">
                            <div class="dmg-num">${p.damage.toLocaleString()}</div>
                            <div class="dmg-bar"><div class="dmg-fill" style="width:${dmgPercent}%"></div></div>
                        </div>
                        <div class="c-wards">${p.wards_placed}</div>
                        <div class="c-cs">${p.cs}</div>
                        <div class="c-items">${itemsHtml}</div>
                    </div>`;
                };

                const html = `
                <div class="game-card ${resultClass}">
                    <div class="game-summary">
                        <div class="info-col" style="padding-left:10px;">
                            <div style="font-weight:bold; color:#5383e8;">Ranked Solo</div>
                            <div>${game.ago}</div>
                            <div style="width:20px; height:1px; background:#444; margin:4px auto;"></div>
                            <div class="result">${resultText}</div>
                            <div>${game.duration}</div>
                        </div>

                        <div class="champ-col">
                            <img src="${CDN}/champion-icons/${me.champion_id}.png" class="champ-icon">
                            <div class="spells">
                                <img src="${D_DRAGON_IMG}/spell/${spellMap[me.spells[0]]||'SummonerFlash'}.png" class="spell-img">
                                <img src="${D_DRAGON_IMG}/spell/${spellMap[me.spells[1]]||'SummonerFlash'}.png" class="spell-img">
                            </div>
                        </div>

                        <div class="kda-col">
                            <span class="kda-text">${me.k} / <span class="deaths">${me.d}</span> / ${me.a}</span>
                            <span class="ratio-text">${me.kda_ratio}:1 KDA</span>
                        </div>

                        <div class="stats-col">
                            <div class="p-kill">P/Kill ${me.p_kill}%</div>
                            <div>Control Ward ${me.wards_control}</div>
                            <div>CS ${me.cs} (${me.cs_min})</div>
                            <div class="tier-badge">${me.tier}</div>
                        </div>

                        <div class="items-col">
                            ${me.items.map(id => id ? `<div class="item-box"><img src="${D_DRAGON_IMG}/item/${id}.png"></div>` : `<div class="item-box"></div>`).join('')}
                        </div>

                        <button class="btn-expand" onclick="toggleDetails(${index})">▼</button>
                    </div>

                    <div id="detail-${index}" class="game-details">
                        <div class="team-blue">
                            <div class="team-header">
                                <span>Victoire (Blue Team)</span>
                                <span>Total Kills: ${game.total_kills_blue}</span>
                            </div>
                            ${game.teams.BLUE.map(renderPlayer).join('')}
                        </div>
                        <div class="team-red">
                            <div class="team-header">
                                <span>Défaite (Red Team)</span>
                                <span>Total Kills: ${game.total_kills_red}</span>
                            </div>
                            ${game.teams.RED.map(renderPlayer).join('')}
                        </div>
                    </div>
                </div>`;
                
                container.innerHTML += html;
            });
        });

    function toggleDetails(id) {
        const el = document.getElementById(`detail-${id}`);
        el.style.display = (el.style.display === "block") ? "none" : "block";
    }
</script>

</body>
</html>